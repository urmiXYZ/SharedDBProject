@model MDUA.Entities.List.ProductVariantList
@using MDUA.Entities

<div class="card mb-3 border-primary">
    <div class="card-header bg-light cursor-pointer" data-bs-toggle="collapse" data-bs-target="#addVariantCollapse">
        <div class="d-flex justify-content-between align-items-center">
            <h6 class="mb-0 text-primary fw-bold">+ Add New Variant</h6>
            <small class="text-muted">(Click to expand)</small>
        </div>
    </div>
    <div id="addVariantCollapse" class="collapse">
        <div class="card-body bg-white">
            <form id="form-add-single-variant">
                <input type="hidden" name="ProductId" value="@ViewBag.ProductId" />
                <input type="hidden" name="VariantName" id="new-variant-name" />

                <input type="hidden" name="StockQty" value="0" />

                <div class="row">
                    @if (ViewBag.ProductAttributes != null)
                    {
                        int i = 0;
                        foreach (var attr in (List<AttributeName>)ViewBag.ProductAttributes)
                        {
                            <div class="col-md-6 mb-2">
                                <label class="small fw-bold">@attr.Name</label>
                                <select class="form-control form-control-sm variant-attr-select"
                                        data-attribute-id="@attr.Id" required>
                                    <option value="">Loading...</option>
                                </select>
                                <input type="hidden" name="AttributeValueIds[@i]" class="final-value-id" />
                            </div>
                            i++;
                        }
                    }
                </div>

                <div class="row mt-2">
                    <div class="col-md-12">
                        <label class="small">Price</label>
                        <input type="number" name="VariantPrice"
                               class="form-control form-control-sm"
                               value="@(ViewBag.BasePrice ?? 0)"
                               placeholder="0.00" required />
                    </div>
                </div>

                <div class="mt-3 text-end">
                    <button type="button" id="btn-save-new-variant" class="btn btn-sm btn-success">
                        Save New Variant
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@if (Model != null && Model.Any())
{
    <table class="table table-striped table-sm variants-table-modal">
        <thead>
            <tr>
                <th>Variant Name</th>
                <th>SKU</th>
                <th>Price</th>
                <th>Stock</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var v in Model)
            {
                <tr data-variant-id="@v.Id">
                    <td>@v.VariantName</td>
                    <td>@(v.SKU ?? "N/A")</td>
                    <td data-col="price">
                        <span class="display-value">Tk. @v.VariantPrice?.ToString("0.00")</span>
                        <input type="number" class="form-control form-control-sm edit-input"
                               value="@v.VariantPrice?.ToString("0.00")" style="display:none; width: 80px;" />
                    </td>
                    <td data-col="stock">@v.StockQty</td>
                    <td>
                        <button type="button" class="btn btn-sm btn-warning js-edit-variant">Edit</button>
                        <button type="button" class="btn btn-sm btn-danger js-delete-variant">Delete</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <div class="empty-state">
        <p>No variants found.</p>
    </div>
}