@model List<MDUA.Entities.VariantImage>

<link rel="stylesheet" href="~/css/product-image.css" />

<div class="card mb-3 product-upload-card">
    <div class="card-header product-upload-header">
        <h6 class="mb-0">Upload Variant Image</h6>
    </div>
    <div class="card-body text-center product-upload-body">
        <div class="mb-3">
            <input type="file"
                   id="upload-variant-image-input"
                   accept="image/*"
                   class="form-control product-file-input" />
        </div>

        <div id="var-cropper-wrapper"
             class="product-cropper-wrapper bg-light"
             style="display:none; min-height: 300px; max-height: 450px; position: relative; border: 1px solid #ddd;">

            <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0 m-2"
                    id="btn-close-var-cropper" style="z-index: 1000; width: 30px; height: 30px; padding: 0; display: flex; align-items: center; justify-content: center; border-radius: 50%;"
                    title="Cancel Crop">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>

            <img id="var-image-to-crop" style="display: block; max-width: 100%;" />
        </div>

        <div id="var-cropper-controls"
             class="mt-3 product-cropper-controls"
             style="display:none;">

            <button type="button" class="btn btn-sm btn-light border-secondary text-secondary product-btn-zoom js-var-zoom-in me-1"
                    title="Zoom In" style="width: 36px; height: 36px; padding: 0; display: inline-flex; align-items: center; justify-content: center;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>
            </button>

            <button type="button" class="btn btn-sm btn-light border-secondary text-secondary product-btn-zoom js-var-zoom-out me-2"
                    title="Zoom Out" style="width: 36px; height: 36px; padding: 0; display: inline-flex; align-items: center; justify-content: center;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>
            </button>

            <button type="button" class="btn btn-sm btn-success product-btn-save" id="btn-confirm-var-upload">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1"><polyline points="20 6 9 17 4 12"></polyline></svg>
                Save Image
            </button>
        </div>
    </div>
</div>

<h6 class="product-gallery-title mb-3">Gallery</h6>

<div class="product-gallery-container">
    @if (Model != null && Model.Any())
    {@foreach (var img in Model.OrderBy(i => i.DisplayOrder)) // ✅ Display sorted
        {
            <div class="card shadow-sm" style="width: 120px;">
                @{
                    var src = img.ImageUrl.Replace("\\", "/");
                    if (!src.StartsWith("/")) { src = "/" + src; }
                }
                <div style="height: 90px; overflow: hidden; position: relative;">
                    <img src="@src" class="w-100 h-100" style="object-fit: cover;" />
                </div>

                <div class="card-body p-1 bg-light">
                    <div class="input-group input-group-sm">
                        <span class="input-group-text px-1" style="font-size: 0.7rem;">Ord</span>
                        <input type="number" class="form-control px-1 text-center js-update-var-order"
                               value="@img.DisplayOrder"
                               data-id="@img.Id"
                               data-variant-id="@img.VariantId"
                               style="font-size: 0.8rem;">
                    </div>
                </div>

                <div class="card-footer p-1 text-center">
                    <button type="button" class="btn btn-xs text-danger w-100 js-del-var-img" data-id="@img.Id">
                        &times; Delete
                    </button>
                </div>
            </div>
        }
    }
    else
    {
        <p class="product-gallery-empty">No images uploaded for this variant.</p>
    }
</div>

<div class="text-end border-top pt-3 mt-3">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
</div>