@model List<MDUA.Entities.ProductImage>

<link rel="stylesheet" href="~/css/product-image.css" />

<div class="card mb-3 product-upload-card">
    <div class="card-header product-upload-header">
        <h6 class="mb-0">Upload & Crop Image</h6>
    </div>

    <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0 m-2"
            id="btn-close-cropper" style="z-index: 1000;" title="Cancel Crop">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
    </button>
    <div class="card-body text-center product-upload-body">
        <div class="mb-3">
            <input type="file"
                   id="upload-image-input"
                   accept="image/*"
                   class="form-control product-file-input" />
        </div>

        <div id="cropper-wrapper"
             class="product-cropper-wrapper bg-light"
             style="display:none; min-height: 300px; max-height: 450px; position: relative; border: 1px solid #ddd;">


            <img id="image-to-crop" style="display: block; max-width: 100%;" />
        </div>

        <div id="cropper-controls"
             class="mt-3 product-cropper-controls"
             style="display:none;">

            <div class="btn-group me-2">
                <button type="button" class="btn btn-sm btn-secondary js-prod-zoom-in" title="Zoom In">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>
                </button>
                <button type="button" class="btn btn-sm btn-secondary js-prod-zoom-out" title="Zoom Out">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>
                </button>
            </div>

            <button type="button"
                    class="btn btn-sm btn-success product-btn-save"
                    id="btn-confirm-upload">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1"><polyline points="20 6 9 17 4 12"></polyline></svg>
                Save Image
            </button>
        </div>
    </div>
</div>

<h6 class="product-gallery-title mb-3">Gallery</h6>

<div class="d-flex flex-wrap gap-3">
    @if (Model != null && Model.Any())
    {
        foreach (var img in Model.OrderBy(i => i.SortOrder)) // Display sorted
        {
            <div class="card shadow-sm" style="width: 140px;">
                @{
                    var imageSrc = img.ImageUrl.Replace("\\", "/");
                    if (!imageSrc.StartsWith("/")) { imageSrc = "/" + imageSrc; }
                    var borderClass = img.IsPrimary ? "border-primary border-3" : "";
                }
                <div class="position-relative @borderClass" style="height: 100px; overflow: hidden;">
                    <img src="@imageSrc" class="w-100 h-100" style="object-fit: cover;" alt="Product Image" />

                    @if (img.IsPrimary)
                    {
                        <span class="position-absolute top-0 start-0 badge bg-primary m-1" style="font-size: 0.65rem;">Primary</span>
                    }
                </div>

                <div class="card-body p-2 bg-light">
                    <div class="form-check mb-2" style="font-size: 0.8rem;">
                        <input class="form-check-input js-set-primary" type="radio"
                               name="primaryImageGroup"
                               id="primary_@img.Id"
                               data-id="@img.Id"
                               data-product-id="@img.ProductId"
                        @(img.IsPrimary ? "checked disabled" : "")>
                        <label class="form-check-label" for="primary_@img.Id">
                            Primary
                        </label>
                    </div>

                    <div class="input-group input-group-sm mb-2">
                        <span class="input-group-text px-1" style="font-size: 0.7rem;">Ord</span>
                        <input type="number" class="form-control px-1 text-center js-update-order"
                               value="@img.SortOrder"
                               data-id="@img.Id"
                               style="font-size: 0.8rem;">
                    </div>
                </div>

                <div class="card-footer p-1 text-center bg-white">
                    <button type="button"
                            class="btn btn-xs btn-outline-danger w-100 js-delete-image"
                            data-id="@img.Id">
                        &times; Delete
                    </button>
                </div>
            </div>
        }
    }
    else
    {
        <p class="text-muted small w-100 text-center">No images uploaded yet.</p>
    }
</div>

<div class="text-end border-top pt-3 mt-3">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
</div>