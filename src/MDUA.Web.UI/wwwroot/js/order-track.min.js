$(document).ready(function(){const s=$("#order-status-modal"),a=$("#open-status-modal"),c=s.find(".close-btn"),p=$("#status-lookup-form"),e=$("#status-result"),n=$("#status-loading");a.on("click",function(){s.css("display","block"),$("#order-id-input").val(""),e.empty(),n.hide()}),c.on("click",function(){s.css("display","none")}),$(window).on("click",function(l){$(l.target).is(s)&&s.css("display","none")}),p.on("submit",function(l){l.preventDefault();const i=$("#order-id-input").val().trim();if(i===""){e.html('<p style="color: red;">Please enter a valid Online Order ID.</p>');return}e.empty(),n.show(),$.ajax({url:"/Order/GetOrderStatus?orderId="+encodeURIComponent(i),type:"GET",dataType:"json",success:function(t){if(n.hide(),t&&t.orderFound&&t.lineItems&&t.lineItems.length>0){const r=parseFloat(t.discountAmount||0),d=parseFloat(t.deliveryCharge||0),u=parseFloat(t.netAmount||0),m=t.lineItems.reduce((o,g)=>o+g.lineTotal,0);let h=t.lineItems.map(o=>`
            <tr>
                <td>${o.productName||"Product Variant"}</td>
                <td class="qty">${o.qty}</td>
                <td class="price">Tk. ${parseFloat(o.price).toFixed(2)}</td>
                <td class="total">Tk. ${parseFloat(o.lineTotal).toFixed(2)}</td>
            </tr>
        `).join("");e.html(`
            <div class="receipt-container">
                <p class="receipt-title">Order Details</p>
                
                <div class="receipt-header-details">
                    <p><strong>Order ID:</strong> ${t.orderId}</p>
                    <p><strong>Status:</strong> <span class="status-badge status-${t.status.toLowerCase()}">${t.status}</span></p>
                    <p><strong>Order Date:</strong> ${t.formattedOrderDate||"N/A"}</p>
                    <p><strong>Estimated Delivery:</strong> ${t.estimatedDelivery}</p>
                    <p><strong>Customer:</strong> ${t.customerName||"N/A"}</p>
                    <p><strong>Ship To:</strong> ${t.customerAddress||"N/A"}</p>
                </div>
                
                <table class="receipt-summary-table">
                    <tr><th>Sub Total (Items)</th><td>Tk. ${m.toFixed(2)}</td></tr>
                    <tr><th>Discount</th><td class="discount-amount">(-) Tk. ${r.toFixed(2)}</td></tr>
                    <tr><th>Net Amount</th><td>Tk. ${u.toFixed(2)}</td></tr>
                    <tr><th>Delivery Charge</th><td>(+) Tk. ${d.toFixed(2)}</td></tr>
                    <tr class="grand-total-row">
                        <th>Grand Total (COD)</th>
                        <td>Tk. ${parseFloat(t.grandTotal).toFixed(2)}</td>
                    </tr>
                </table>
                
                <p class="thank-you-message">Thank you for placing your order!</p>
            </div>
        `)}else e.html('<p style="color: red; font-weight: bold; text-align: center;">Order Not Found \u{1F614}</p><p style="text-align: center;">Please double-check the Order ID.</p>')},error:function(t){n.hide();let r="Could not connect to the tracking service.";try{r=JSON.parse(t.responseText).message||r}catch{t.status===500&&(r="Internal Server Error: Data Processing Failed.")}e.html(`<p style="color: red; font-weight: bold; text-align: center;">Error: ${r}</p>`)}})})});
